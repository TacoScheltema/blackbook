{% extends "base.html" %}

{% block content %}
<div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
        <h1 class="my-2">{{ title }}</h1>
    </div>
    <div class="card-body">
        <form action="{{ url_for('main.edit_person', b64_dn=b64_dn) }}" method="post">
            <div class="row">
                {# Loop through the configured attributes to dynamically create the form. #}
                {% for attr in config.LDAP_PERSON_ATTRIBUTES %}
                <div class="col-md-6 mb-3">
                    {# Create a user-friendly label from the attribute name. #}
                    <label for="{{ attr }}" class="form-label text-capitalize">{{ attr.replace('telephoneNumber', 'Telephone') }}</label>

                    {# Special handling for the company ('o') attribute to show a datalist. #}
                    {% if attr == 'o' %}
                        <input class="form-control" list="company-options" id="o" name="o" value="{{ person.o[0] if person.o }}">
                        <datalist id="company-options">
                            {% for company in companies %}
                                <option value="{{ company.o }}">
                            {% endfor %}
                        </datalist>
                    {% else %}
                        {# Determine input type based on attribute name for better UX. #}
                        {% set input_type = 'text' %}
                        {% if attr == 'mail' %}{% set input_type = 'email' %}{% endif %}
                        {% if attr == 'telephoneNumber' %}{% set input_type = 'tel' %}{% endif %}
                        <input type="{{ input_type }}" class="form-control" id="{{ attr }}" name="{{ attr }}" value="{{ person[attr][0] if person[attr] }}">
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="{{ url_for('main.person_detail', b64_dn=b64_dn) }}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>
{% endblock %}


