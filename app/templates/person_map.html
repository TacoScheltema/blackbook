<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
{% extends "base.html" %}

{% block head_scripts %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
{% endblock %}

{% block content %}
<div class="card card-margin">
    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h1 class="my-2">{{ person.cn[0] if person.cn else 'Unknown' }}</h1>
        <div>
            <a href="{{ url_for('main.person_detail', b64_dn=b64_dn) }}" class="btn btn-outline-light" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Detail View">
                <i class="bi bi-person-lines-fill"></i>
            </a>
            <a href="{{ url_for('main.person_map', b64_dn=b64_dn) }}" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Map View">
                <i class="bi bi-geo-alt-fill"></i>
            </a>
        </div>
    </div>
    <div class="card-body">
        {% if latitude and longitude %}
            <h5 class="card-title">Location</h5>
            <div id="map" style="height: 500px; border-radius: 4px;"></div>
        {% else %}
            <p class="text-center text-muted">Insufficient details to find a location on the map.</p>
        {% endif %}
    </div>
</div>

{% if latitude and longitude %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const lat = {{ latitude|tojson }};
        const lon = {{ longitude|tojson }};
        const personName = {{ (person.cn[0] if person.cn else 'Contact')|tojson }};

        const map = L.map('map').setView([lat, lon], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        L.marker([lat, lon]).addTo(map)
            .bindPopup(`<b>${personName}</b>`).openPopup();
    });
</script>
{% endif %}
{% endblock %}
